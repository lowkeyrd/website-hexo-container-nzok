edition: 1.0.0          #  命令行YAML规范版本，遵循语义化版本（Semantic Versioning）规范
name: website-hexo-container2#  项目名称
access: 'default'  #  秘钥别名

services:
  framework: #  服务名称
    component: fc  # 组件名称
    actions:
      pre-deploy: # 在deploy之前运行
        # 先将 base镜像预热到缓存目录，--cache-dir 表示缓存目录，--image 表示base镜像，可以指定多个
        # 如果要使用nas，cicd.yaml中的 runnerConfig 要指定 nasConfig，并且将--cache-dir 指定成 nasnCofig.mountDir
        - run: warmer --image=registry.ap-southeast-1.aliyuncs.com/fc-demo/test:fengchongV1 --cache-dir=/mnt/image-cache
        # 使用缓存目录构建镜像
        - component: fc build --use-docker --dockerfile ./code/Dockerfile --cache-dir=/mnt/image-cache
    props: #  组件的属性值
      region: 'ap-southeast-1'
      service:
        name: 'website'
        description: "Serverless Devs Website Service"
        role: 'acs:ram::${config(AccountID)}:role/AliyunFcDefaultRole'
      function:
        name: 'hexo-custom-container'
        description: "Serverless Devs Website hexo Function"
        codeUri: ./code
        memorySize: 512
        runtime: custom-container
        customContainerConfig:
          image: 'registry-vpc.ap-southeast-1.aliyuncs.com/fc-demo/test-springboot-demo:1.0'
        timeout: 30
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
              - DELETE
      customDomains:
        - domainName: auto
          protocol: HTTP
          routeConfigs:
            - path: /*
